package head
create or replace PACKAGE project4
AS
   TYPE instructor_info_cursor IS REF CURSOR;
   PROCEDURE get_instructor_list(p_output OUT SYS_REFCURSOR);
   PROCEDURE get_instructor_info(p_instructor_id IN instructor.instructor_id%TYPE, 
                                 p_output OUT SYS_REFCURSOR, 
                                 p_student_output OUT SYS_REFCURSOR);
   PROCEDURE update_section_capacity(p_section_id IN section.section_id%TYPE, p_capacity IN section.capacity%TYPE);
   FUNCTION get_students_for_section(p_section_id IN section.section_id%TYPE)RETURN SYS_REFCURSOR;
END project4;


========================================
create or replace PACKAGE BODY project4 
AS  
   -- Get list of instructor and display it later in dropdown list
   PROCEDURE get_instructor_list(p_output OUT SYS_REFCURSOR) 
   IS 
   BEGIN 
      OPEN p_output FOR  
      SELECT INSTRUCTOR_ID, SALUTATION, FIRST_NAME, LAST_NAME  
        FROM INSTRUCTOR;  
   END get_instructor_list; 

   PROCEDURE get_instructor_info(
      p_instructor_id IN instructor.instructor_id%TYPE, 
      p_output OUT SYS_REFCURSOR,
      p_student_output OUT SYS_REFCURSOR) 
   IS 
   BEGIN 
      OPEN p_output FOR 
          SELECT 
             c.course_no || c.DESCRIPTION as course_name,  s.SECTION_NO, 
             s.START_DATE_TIME, s.LOCATION, s.CAPACITY 
          FROM INSTRUCTOR i 
          JOIN SECTION s ON i.INSTRUCTOR_ID = s.INSTRUCTOR_ID 
          JOIN COURSE c ON s.COURSE_NO = c.COURSE_NO 
          WHERE 
            i.INSTRUCTOR_ID = p_instructor_id; 
      
      OPEN p_student_output FOR
         SELECT
            stud.STUDENT_ID, stud.FIRST_NAME, stud.LAST_NAME
         FROM
            SECTION sec
         JOIN ENROLLMENT e ON sec.SECTION_ID = e.SECTION_ID
         JOIN STUDENT stud ON e.STUDENT_ID = stud.STUDENT_ID
         WHERE
            sec.INSTRUCTOR_ID = p_instructor_id;
      END get_instructor_info; 

   -- Update capacity in each section
   PROCEDURE update_section_capacity(p_section_id IN section.section_id%TYPE, p_capacity IN section.capacity%TYPE) 
   IS 
   BEGIN 
      UPDATE SECTION SET CAPACITY = p_capacity WHERE SECTION_ID = p_section_id; 
      COMMIT; 
   END update_section_capacity; 

   -- Function to display student list in each sections
   FUNCTION get_students_for_section(p_section_id IN section.section_id%TYPE)RETURN SYS_REFCURSOR 
   IS 
      cursor_student SYS_REFCURSOR; 
   BEGIN 
      OPEN cursor_student FOR 
      SELECT stud.student_id, stud.first_name, stud.last_name 
      FROM student stud 
      JOIN enrollment e ON stud.student_id = e.student_id
      JOIN section sec ON e.section_id = sec.section_id 
      WHERE sec.section_id = p_section_id; 
    RETURN cursor_student; 
  END get_students_for_section; 
END project4;

============================================== OUTPUT
COURSE_NO DESCRIPTION SECTION_ID SECTION_NO START_DATE_TIME LOCATION CAPACITY
25	Intro to Programming	87	3	14-APR-07	L507	25
120	Intro to Java Programming	148	3	24-MAY-07	L509	25
122	Intermediate Java Programming	156	5	15-MAY-07	L507	25
125	Java Developer I	133	4	03-MAY-07	L211	15
134	Advanced Unix Admin	140	1	16-APR-07	L509	25
140	Systems Analysis	117	2	02-JUN-07	L210	15
146	Java for C/C++ Programmers	125	1	29-APR-07	L509	25
240	Intro to the BASIC Language	101	1	16-APR-07	L509	10
450	DB Programming with Java	109	1	14-APR-07	L507	25

========================================================

output in the front end
Course Name	Section Number	Starting Date	Location	Capacity
Intro to Programming	3	4/14/2007 9:30:00 AM	L507	25
Course Name	Section Number	Starting Date	Location	Capacity
Intro to Java Programming	3	5/24/2007 9:30:00 AM	L509	25
Course Name	Section Number	Starting Date	Location	Capacity
Intermediate Java Programming	5	5/15/2007 9:30:00 AM	L507	25
Course Name	Section Number	Starting Date	Location	Capacity
Java Developer I	4	5/3/2007 9:30:00 AM	L211	15
Course Name	Section Number	Starting Date	Location	Capacity
Advanced Unix Admin	1	4/16/2007 9:30:00 AM	L509	25
Course Name	Section Number	Starting Date	Location	Capacity
Systems Analysis	2	6/2/2007 9:30:00 AM	L210	15
Course Name	Section Number	Starting Date	Location	Capacity
Java for C/C++ Programmers	1	4/29/2007 9:30:00 AM	L509	25
Course Name	Section Number	Starting Date	Location	Capacity
Intro to the BASIC Language	1	4/16/2007 9:30:00 AM	L509	10
Course Name	Section Number	Starting Date	Location	Capacity
DB Programming with Java	1	4/14/2007 10:30:00 AM	L507	25
